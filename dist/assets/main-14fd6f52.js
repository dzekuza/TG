import{c as j,j as e,r as u,C as k,a as M,M as P,A as $,b as O,T as A,P as T,d as D,R as F}from"./index-dce117be.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=j("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=j("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=j("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=j("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=j("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=j("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);function H({product:a,quantity:r,onQuantityChange:t}){const i=()=>{r>0&&t(a.id,r-1)},x=()=>{t(a.id,r+1)},l=a.price,n=a.price*2*.95,h=a.price*3*.9;return e.jsx("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex flex-col items-start text-left",children:[e.jsx("div",{className:"w-16 h-16 mb-3 rounded-xl bg-gray-100 flex items-center justify-center overflow-hidden",children:e.jsx("span",{className:"text-2xl",children:a.emoji})}),e.jsx("h3",{className:"mb-1 font-semibold text-base",children:a.name}),e.jsxs("div",{className:"text-xl text-blue-600 mb-1",children:["â‚¬",l.toFixed(2)]}),e.jsxs("div",{className:"text-xs text-gray-500 mb-2",children:["2x â‚¬",n.toFixed(2),", 3x â‚¬",h.toFixed(2)]}),e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("button",{onClick:i,className:"w-8 h-8 rounded-lg border-2 border-gray-200 flex items-center justify-center hover:bg-gray-50 transition-colors",disabled:r===0,children:e.jsx(I,{className:"w-4 h-4 text-gray-600"})}),e.jsx("span",{className:"w-8 text-center",children:r}),e.jsx("button",{onClick:x,className:"w-8 h-8 rounded-lg border-2 border-blue-200 bg-blue-50 flex items-center justify-center hover:bg-blue-100 transition-colors",children:e.jsx(G,{className:"w-4 h-4 text-blue-600"})})]}),r>0&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Total: â‚¬",(a.price*r).toFixed(2)]})]})})}function R({products:a,cart:r,onQuantityChange:t,onGoToCart:i}){const x=Object.values(r).reduce((l,n)=>l+n,0);return e.jsxs("div",{className:"p-4 pb-32 relative",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-center text-gray-800 mb-2",children:"ðŸ” Food Delivery"}),e.jsx("p",{className:"text-center text-gray-600 text-sm",children:"Choose your favorite items"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:a.map(l=>e.jsx(H,{product:l,quantity:r[l.id]||0,onQuantityChange:t},l.id))}),x>0&&e.jsxs("button",{className:"fixed left-1/2 -translate-x-1/2 bottom-20 z-30 bg-blue-600 text-white px-8 py-3 rounded-full shadow-lg text-lg font-semibold flex items-center gap-2 animate-fade-in",onClick:i,children:["ðŸ›’ Add to Cart (",x,")"]})]})}function _({products:a,cart:r,onQuantityChange:t,onClearCart:i,onSubmitOrder:x}){const[l,n]=u.useState(""),[h,g]=u.useState(""),d=a.filter(s=>r[s.id]>0),o=Object.values(r).reduce((s,c)=>s+c,0),m=o,b=d.reduce((s,c)=>s+c.price*r[c.id],0);let y=0,f=0;m>=2&&(y=Math.min(.1*(m-1),.3)),m>=1&&m<4?f=.1*m:m<6&&(f=.1*(m+1-1));const v=b*y,w=b-v;return d.length===0?e.jsxs("div",{className:"p-4 pb-20 flex flex-col items-center justify-center min-h-96",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ›’"}),e.jsx("h2",{className:"text-gray-800 mb-2",children:"Your cart is empty"}),e.jsx("p",{className:"text-gray-600 text-center text-sm",children:"Add some delicious items from our menu to get started!"})]}):e.jsxs("div",{className:"p-4 pb-20",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-center text-gray-800 mb-2",children:"ðŸ§¾ Your Order"}),e.jsxs("p",{className:"text-center text-gray-600 text-sm",children:[o," item",o!==1?"s":""," in your cart"]})]}),e.jsx("div",{className:"space-y-4 mb-6",children:d.map(s=>e.jsx("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-xl bg-gray-100 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-2xl",children:s.emoji})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"mb-1",children:s.name}),e.jsxs("p",{className:"text-gray-600 text-sm mb-2",children:["$",s.price.toFixed(2)," each"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["Qty: ",r[s.id]," Ã— $",s.price.toFixed(2)," = $",(s.price*r[s.id]).toFixed(2)]}),e.jsx("button",{onClick:()=>t(s.id,0),className:"text-red-500 hover:text-red-700 transition-colors",children:e.jsx(U,{className:"w-4 h-4"})})]})]})]})},s.id))}),m>0&&y<.3&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-2xl p-4 mb-6 text-yellow-800 text-center text-sm",children:["Add 1 more item for ",Math.round(f*100),"% off your total!"]}),y>0&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-2xl p-4 mb-6 text-green-800 text-center text-sm",children:["Discount applied: -",Math.round(y*100),"%"]}),e.jsx("div",{className:"bg-blue-50 rounded-2xl p-4 mb-6 border border-blue-100",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg text-gray-800",children:"Total:"}),e.jsxs("span",{className:"text-xl text-blue-600",children:["$",w.toFixed(2)]})]})}),e.jsx("div",{className:"mb-6 text-center text-gray-700 text-sm",children:"Prepare cash and don't be late in agreed location."}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"Delivery Address"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",className:"flex-1 rounded-xl border border-gray-300 p-3 text-gray-800",placeholder:"Enter address or paste Google Maps link",value:l,onChange:s=>n(s.target.value)}),e.jsx("button",{type:"button",className:"bg-blue-100 text-blue-700 px-3 py-2 rounded-xl text-xs font-semibold hover:bg-blue-200",onClick:()=>window.open("https://maps.google.com","_blank"),children:"Get my address"}),e.jsx("button",{type:"button",className:"bg-gray-100 text-gray-700 px-3 py-2 rounded-xl text-xs font-semibold hover:bg-gray-200",onClick:async()=>{const s=await navigator.clipboard.readText();n(s)},children:"Paste location"})]}),e.jsx("button",{type:"button",className:"mt-2 w-full bg-green-100 text-green-700 px-3 py-2 rounded-xl text-xs font-semibold hover:bg-green-200",onClick:()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(s=>{const{latitude:c,longitude:p}=s.coords;n(`https://www.google.com/maps?q=${c},${p}`)},s=>{alert("Could not fetch location. Please allow location access.")}):alert("Geolocation is not supported by your browser.")},children:"Fetch my location"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"Comments"}),e.jsx("textarea",{className:"w-full rounded-xl border border-gray-300 p-3 text-gray-800",placeholder:"Any notes for the courier? (optional)",value:h,onChange:s=>g(s.target.value),rows:2})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:i,className:"flex-1 bg-gray-100 hover:bg-gray-200 transition-colors rounded-xl p-4 text-gray-700",children:"Clear Cart"}),e.jsx("button",{onClick:()=>x({address:l,comment:h}),className:"flex-1 bg-green-500 hover:bg-green-600 transition-colors rounded-xl p-4 text-white",children:"Place Order"})]})]})}const J=a=>{switch(a){case"pending":return{icon:e.jsx(k,{className:"w-4 h-4"}),label:"Pending",bgColor:"bg-yellow-100",textColor:"text-yellow-700",borderColor:"border-yellow-200"};case"preparing":return{icon:e.jsx(T,{className:"w-4 h-4"}),label:"Preparing",bgColor:"bg-blue-100",textColor:"text-blue-700",borderColor:"border-blue-200"};case"on-the-way":case"arriving":return{icon:e.jsx(A,{className:"w-4 h-4"}),label:"On the way",bgColor:"bg-orange-100",textColor:"text-orange-700",borderColor:"border-orange-200"};case"delivered":case"arrived":return{icon:e.jsx(O,{className:"w-4 h-4"}),label:"Delivered",bgColor:"bg-green-100",textColor:"text-green-700",borderColor:"border-green-200"};case"cancelled":return{icon:e.jsx($,{className:"w-4 h-4"}),label:"Cancelled",bgColor:"bg-red-100",textColor:"text-red-700",borderColor:"border-red-200"};default:return{icon:e.jsx(k,{className:"w-4 h-4"}),label:a||"Unknown",bgColor:"bg-gray-100",textColor:"text-gray-700",borderColor:"border-gray-200"}}},Y=a=>{const r=new Date(a),t=new Date,i=r.toDateString()===t.toDateString(),x=r.toDateString()===new Date(t.getTime()-24*60*60*1e3).toDateString();return i?`Today at ${r.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}`:x?`Yesterday at ${r.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}`:r.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};function B({orders:a=[]}){function r(t,i){const[x,l]=u.useState(t);return u.useEffect(()=>{if(!t||!i)return;const n=new Date(i).getTime(),h=setInterval(()=>{const g=Date.now(),d=Math.floor((g-n)/6e4),o=Math.max(0,t-d);l(o)},1e4);return()=>clearInterval(h)},[t,i]),x}return a.length===0?e.jsxs("div",{className:"p-4 pb-20 flex flex-col items-center justify-center min-h-96",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“‹"}),e.jsx("h2",{className:"text-gray-800 mb-2",children:"No order history"}),e.jsx("p",{className:"text-gray-600 text-center text-sm",children:"Your past orders will appear here once you place your first order!"})]}):e.jsxs("div",{className:"p-4 pb-20",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-center text-gray-800 mb-2",children:"ðŸ“‹ Order History"}),e.jsx("p",{className:"text-center text-gray-600 text-sm",children:"Track your past orders and delivery status"})]}),e.jsx("div",{className:"space-y-4",children:a.map(t=>{const i=J(t.status);let x="";try{const d=typeof t.items=="string"?JSON.parse(t.items):t.items;x=Array.isArray(d)?d.map(o=>`${o.emoji?o.emoji+" ":""}${o.name||o.meal||""}${o.qty?" x"+o.qty:""}`).join(", "):t.items}catch{x=t.items}let l=t.location,n="",h=!1;try{typeof l=="string"&&l.startsWith("{")&&(l=JSON.parse(l))}catch{}if(n=(l==null?void 0:l.manual)||l,h=typeof n=="string"&&n.includes("google.com/maps"),h){const d=n.match(/@([\d.\-]+),([\d.\-]+)/);d&&(d[1],d[2])}const g=t.eta?r(Number(t.eta),t.updated_at||t.created_at):null;return e.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-sm border border-gray-100",children:[e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"w-full p-3 rounded-lg text-center font-semibold text-blue-800 bg-blue-50 border border-blue-100",children:[e.jsx(k,{className:"w-4 h-4 inline-block mr-1 align-text-bottom text-blue-600"}),t.eta?g>0?`ETA: ${g} min`:"Arriving soon":"ETA: Calculating..."]})}),e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center gap-1.5 px-2 py-1 rounded-lg border mb-1 ${i.bgColor} ${i.textColor} ${i.borderColor}`,children:[i.icon,e.jsx("span",{className:"text-xs",children:i.label})]}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-500 text-sm",children:[e.jsx(M,{className:"w-3 h-3"}),e.jsx("span",{children:Y(t.created_at)})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-gray-900",children:["â‚¬",t.total||"0.00"]}),e.jsxs("div",{className:"text-gray-500 text-sm",children:[x.split(",").length," items"]})]})]}),e.jsx("div",{className:"space-y-2 mb-4",children:e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-lg",children:"ðŸ½ï¸"}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"text-sm text-gray-900",children:x})})]})}),t.comment&&e.jsxs("div",{className:"flex items-start gap-2 mb-3 p-3 bg-green-50 rounded-lg border border-green-100",children:[e.jsx(z,{className:"w-4 h-4 text-green-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-green-700 mb-1",children:"Comment:"}),e.jsx("div",{className:"text-sm text-green-800",children:t.comment})]})]}),n&&e.jsx("div",{className:"space-y-2 text-sm text-gray-600",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-3 h-3"}),(()=>{let d=null,o=null,m=!1;if(typeof n=="string"){let b=n.match(/@([\d.\-]+),([\d.\-]+)/);b||(b=n.match(/q=([\d.\-]+),([\d.\-]+)/)),b&&(d=b[1],o=b[2],m=!0)}return m&&d&&o?e.jsx(e.Fragment,{children:e.jsx("iframe",{title:"Google Map",width:"100%",height:"180",className:"rounded-lg border mt-2",src:`https://maps.google.com/maps?q=${d},${o}&z=15&output=embed`,allowFullScreen:!0})}):e.jsx("span",{children:typeof n=="string"?n:JSON.stringify(n)})})()]})})]},t.order_id)})})]})}const C=[{id:1,name:"Classic Burger",price:12.99,emoji:"ðŸ”",description:"Juicy beef patty with lettuce, tomato, and cheese"},{id:2,name:"Pepperoni Pizza",price:18.99,emoji:"ðŸ•",description:"Classic pizza with pepperoni and mozzarella"},{id:3,name:"Caesar Salad",price:9.99,emoji:"ðŸ¥—",description:"Fresh romaine lettuce with Caesar dressing"},{id:4,name:"Chicken Tacos",price:14.99,emoji:"ðŸŒ®",description:"Grilled chicken with fresh vegetables and salsa"},{id:5,name:"French Fries",price:4.99,emoji:"ðŸŸ",description:"Crispy golden fries with sea salt"},{id:6,name:"Chocolate Cake",price:8.99,emoji:"ðŸ°",description:"Rich chocolate cake with cream filling"}];function Q(){const[a,r]=u.useState("products"),[t,i]=u.useState({}),[x,l]=u.useState([]),[n,h]=u.useState(!1),[g,d]=u.useState(null);u.useEffect(()=>{var s;if(window.Telegram&&window.Telegram.WebApp){window.Telegram.WebApp.ready();const c=(s=window.Telegram.WebApp.initDataUnsafe)==null?void 0:s.user;c&&(d(c),o(c.id))}},[]);const o=async s=>{try{const p=await(await fetch(`/api/orders?user_id=${s}`)).json();p.orders&&l(p.orders)}catch(c){console.error("Error loading past orders:",c)}},m=(s,c)=>{i(p=>({...p,[s]:c}))},b=()=>{i({})},y=async({address:s,comment:c}={})=>{if(!g){alert("Please log in to place an order");return}const p=C.filter(N=>t[N.id]>0);if(p.length===0){alert("Please add at least one item to your cart");return}h(!0);try{const N={meal:p.map(S=>`${S.name} x${t[S.id]}`).join(", "),user:g,location:s?{manual:s}:{lat:0,lng:0},comment:c||""};(await(await fetch("/api/order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(N)})).json()).success?(alert("Order placed successfully!"),i({}),o(g.id),r("history")):alert("Failed to place order. Please try again.")}catch(N){console.error("Error placing order:",N),alert("Error placing order. Please try again.")}finally{h(!1)}},f=()=>r("orders"),v=Object.values(t).reduce((s,c)=>s+c,0),w=()=>{switch(a){case"products":return e.jsx(R,{products:C,cart:t,onQuantityChange:m,onGoToCart:f});case"orders":return e.jsx(_,{products:C,cart:t,onQuantityChange:m,onClearCart:b,onSubmitOrder:y});case"history":return e.jsx(B,{orders:x});default:return null}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"pb-16",children:w()}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-2 py-2",children:e.jsxs("div",{className:"flex",children:[e.jsxs("button",{onClick:()=>r("products"),className:`flex-1 flex flex-col items-center gap-1 py-2 px-3 rounded-xl transition-colors ${a==="products"?"bg-blue-50 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:[e.jsx(T,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Products"})]}),e.jsxs("button",{onClick:()=>r("orders"),className:`flex-1 flex flex-col items-center gap-1 py-2 px-3 rounded-xl transition-colors relative ${a==="orders"?"bg-blue-50 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"w-5 h-5"}),v>0&&e.jsx("div",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center",children:v})]}),e.jsx("span",{className:"text-xs",children:"Cart"})]}),e.jsxs("button",{onClick:()=>r("history"),className:`flex-1 flex flex-col items-center gap-1 py-2 px-3 rounded-xl transition-colors ${a==="history"?"bg-blue-50 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:[e.jsx(E,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"History"})]})]})}),n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Placing your order..."})]})})]})}D.createRoot(document.getElementById("root")).render(e.jsx(F.StrictMode,{children:e.jsx(Q,{})}));
