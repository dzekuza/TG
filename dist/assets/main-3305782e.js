import{c as P,j as e,P as D,r as h,C as T,A as E,a as I,T as _,b as O,d as q,R as G}from"./index-885146ff.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=P("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=P("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=P("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=P("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=P("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);function Q({products:n,cart:l,onQuantityChange:c,onGoToCart:p}){const s=Object.values(l).reduce((u,x)=>u+x,0),g=n&&n.length>0;return e.jsxs("div",{className:"p-4 pb-32 relative",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-center text-gray-800 mb-2",children:"🍔 Maisto pristatymas"}),e.jsx("p",{className:"text-center text-gray-600 text-sm",children:"Išsirinkite mėgstamus patiekalus"})]}),g?e.jsx("div",{className:"grid grid-cols-2 gap-4",children:n.map(u=>e.jsx(D,{product:u,quantity:l[u.id]||0,onQuantityChange:c},u.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-40 text-gray-500 text-lg py-12",children:[e.jsx("span",{className:"text-5xl mb-2",children:"😔"}),e.jsx("span",{children:"Šiuo metu produktų nėra."})]}),s>0&&e.jsxs("button",{className:"fixed left-1/2 -translate-x-1/2 bottom-20 z-30 bg-blue-600 text-white px-8 py-3 rounded-full shadow-lg text-lg font-semibold flex items-center gap-2 animate-fade-in",onClick:p,children:["Į krepšelį (",s,")"]})]})}function z(n,l){if(!Array.isArray(n))return 0;const c=n.find(p=>l>=p.min&&l<=p.max);return c?c.price:0}function R({products:n,cart:l,onQuantityChange:c,onClearCart:p,onSubmitOrder:s}){const[g,u]=h.useState(""),[x,d]=h.useState("");h.useState(!1);const[N,b]=h.useState(!1),[i,r]=h.useState(""),j=n.filter(t=>l[t.id]>0),y=Object.values(l).reduce((t,a)=>t+a,0),f=y,C=(t,a)=>z(t.price_ranges,a)*a,M=j.reduce((t,a)=>t+C(a,l[a.id]),0);let v=0,w=0,S=0;f>=2&&(v=Math.min(.1*(f-1),.3)),f>=1&&f<4?(w=.1*f,S=1):f<6&&(w=.1*(f+1-1),S=6-f);function m(t){return typeof t=="string"&&t.trim().startsWith("https://www.google.com/maps?q=")}return j.length===0?e.jsxs("div",{className:"p-4 pb-20 flex flex-col items-center justify-center min-h-96",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🛒"}),e.jsx("h2",{className:"text-gray-800 mb-2",children:"Jūsų krepšelis tuščias"}),e.jsx("p",{className:"text-gray-600 text-center text-sm",children:"Pridėkite patiekalų iš meniu, kad pradėtumėte užsakymą!"})]}):e.jsxs("div",{className:"p-4 pb-20",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-center text-gray-800 mb-2",children:"🧾 Jūsų užsakymas"}),e.jsxs("p",{className:"text-center text-gray-600 text-sm",children:[y," prekė",y!==1?"s":""," krepšelyje"]})]}),e.jsx("div",{className:"space-y-4 mb-6",children:j.map(t=>{const a=l[t.id],o=C(t,a);return e.jsx("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-xl bg-gray-100 flex items-center justify-center flex-shrink-0 overflow-hidden",children:t.image_url?e.jsx("img",{src:t.image_url,alt:t.name,className:"w-full h-full object-cover rounded-xl",onError:A=>{A.target.style.display="none"}}):e.jsx("span",{className:"text-2xl",children:t.emoji})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"mb-1",children:t.name}),e.jsxs("p",{className:"text-gray-600 text-sm mb-2",children:[a," vnt × €",(o/a).toFixed(2)," = €",o.toFixed(2)]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["Kiekis: ",a]}),e.jsx("button",{onClick:()=>c(t.id,0),className:"text-red-500 hover:text-red-700 transition-colors",children:e.jsx(K,{className:"w-4 h-4"})})]})]})]})},t.id)})}),f>0&&v<.3&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-2xl p-4 mb-6 text-yellow-800 text-center text-sm",children:["Pridėkite dar ",S," prekę (-es), kad gautumėte ",Math.round(w*100),"% nuolaidą!"]}),v>0&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-2xl p-4 mb-6 text-green-800 text-center text-sm",children:["Nuolaida pritaikyta: -",Math.round(v*100),"%"]}),e.jsx("div",{className:"bg-blue-50 rounded-2xl p-4 mb-6 border border-blue-100",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg text-gray-800",children:"Iš viso:"}),e.jsxs("span",{className:"text-xl text-blue-600",children:["€",M.toFixed(2)]})]})}),e.jsx("div",{className:"mb-6 text-center text-gray-700 text-sm",children:"Paruoškite grynųjų pinigų ir nevėluokite į susitikimo vietą."}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"Pristatymo adresas"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",className:"flex-1 rounded-xl border border-gray-300 p-3 text-gray-800",placeholder:"Įveskite adresą arba įklijuokite Google Maps nuorodą",value:g,onChange:t=>u(t.target.value)}),e.jsx("button",{type:"button",className:"px-3 py-2 rounded-xl bg-blue-100 text-blue-700 font-semibold hover:bg-blue-200 transition-colors whitespace-nowrap",onClick:async()=>{if(b(!0),r(""),!navigator.geolocation){r("Jūsų naršyklė nepalaiko geolokacijos"),b(!1);return}navigator.geolocation.getCurrentPosition(t=>{const a=t.coords.latitude,o=t.coords.longitude;u(`https://www.google.com/maps?q=${a},${o}`),b(!1)},t=>{r("Nepavyko gauti lokacijos"),b(!1)})},disabled:N,children:N?"Gaunama...":"Gauti mano lokaciją"}),e.jsx("button",{type:"button",className:"px-3 py-2 rounded-xl bg-blue-50 text-blue-700 font-semibold hover:bg-blue-100 transition-colors whitespace-nowrap",onClick:()=>window.open("https://maps.google.com","_blank"),children:"Atidaryti Google žemėlapius"})]}),i&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:i}),g.startsWith("https://goo.gl/maps")&&e.jsx("div",{className:"text-yellow-700 text-xs mt-1",children:'Įklijuotas Google Maps nuoroda yra sutrumpinta. Prašome nukopijuoti pilną nuorodą su koordinatėmis (pvz., ilgai paspauskite ant žemėlapio ir pasirinkite "Kopijuoti nuorodą su koordinatėmis").'})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"Komentarai"}),e.jsx("textarea",{className:"w-full rounded-xl border border-gray-300 p-3 text-gray-800",placeholder:"Pastabos kurjeriui? (nebūtina)",value:x,onChange:t=>d(t.target.value),rows:2})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:p,className:"flex-1 bg-gray-100 hover:bg-gray-200 transition-colors rounded-xl p-4 text-gray-700",children:"Išvalyti krepšelį"}),e.jsx("button",{onClick:()=>{if(!m(g)){alert("Įveskite galiojantį Google Maps adresą prieš pateikdami užsakymą.");return}s({address:g,comment:x})},className:"flex-1 bg-green-500 hover:bg-green-600 transition-colors rounded-xl p-4 text-white",children:"Patvirtinti užsakymą"})]})]})}const W=n=>{switch(n){case"pending":return{icon:e.jsx(T,{className:"w-4 h-4"}),label:"Laukiama",bgColor:"bg-yellow-100",textColor:"text-yellow-700",borderColor:"border-yellow-200"};case"preparing":return{icon:e.jsx(O,{className:"w-4 h-4"}),label:"Ruošiama",bgColor:"bg-blue-100",textColor:"text-blue-700",borderColor:"border-blue-200"};case"on-the-way":case"arriving":return{icon:e.jsx(_,{className:"w-4 h-4"}),label:"Pakeliui",bgColor:"bg-orange-100",textColor:"text-orange-700",borderColor:"border-orange-200"};case"delivered":case"arrived":return{icon:e.jsx(I,{className:"w-4 h-4"}),label:"Pristatyta",bgColor:"bg-green-100",textColor:"text-green-700",borderColor:"border-green-200"};case"cancelled":return{icon:e.jsx(E,{className:"w-4 h-4"}),label:"Atšaukta",bgColor:"bg-red-100",textColor:"text-red-700",borderColor:"border-red-200"};default:return{icon:e.jsx(T,{className:"w-4 h-4"}),label:n||"Nežinoma",bgColor:"bg-gray-100",textColor:"text-gray-700",borderColor:"border-gray-200"}}},B=n=>{const l=new Date(n),c=new Date,p=l.toDateString()===c.toDateString(),s=l.toDateString()===new Date(c.getTime()-24*60*60*1e3).toDateString();return p?`Today at ${l.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}`:s?`Yesterday at ${l.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}`:l.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};function H({orders:n=[]}){const[l,c]=h.useState([]);function p(s){const[g,u]=h.useState(null);return h.useEffect(()=>{if(!s)return;const x=setInterval(()=>{const b=new Date(s).getTime(),i=Date.now(),r=Math.max(0,Math.ceil((b-i)/6e4));u(r)},1e4),d=new Date(s).getTime(),N=Date.now();return u(Math.max(0,Math.ceil((d-N)/6e4))),()=>clearInterval(x)},[s]),g}return n.length===0?e.jsxs("div",{className:"p-4 pb-20 flex flex-col items-center justify-center min-h-96",children:[e.jsx("div",{className:"text-6xl mb-4",children:"📋"}),e.jsx("h2",{className:"text-gray-800 mb-2",children:"Nėra užsakymų istorijos"}),e.jsx("p",{className:"text-gray-600 text-center text-sm",children:"Jūsų ankstesni užsakymai atsiras čia, kai pateiksite pirmą užsakymą!"})]}):e.jsxs("div",{className:"p-4 pb-20",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-center text-gray-800 mb-2",children:"📋 Užsakymų istorija"}),e.jsx("p",{className:"text-center text-gray-600 text-sm",children:"Stebėkite savo užsakymų būseną ir pristatymą"})]}),e.jsx("div",{className:"space-y-4",children:n.filter(s=>!l.includes(s.order_id)).map(s=>{const g=W(s.status);let u="";try{const i=typeof s.items=="string"?JSON.parse(s.items):s.items;u=Array.isArray(i)?i.map(r=>`${r.emoji?r.emoji+" ":""}${r.name||r.meal||""}${r.qty?" x"+r.qty:""}`).join(", "):s.items}catch{u=s.items}let x=s.location,d="",N=!1;try{typeof x=="string"&&x.startsWith("{")&&(x=JSON.parse(x))}catch{}if(d=(x==null?void 0:x.manual)||x,N=typeof d=="string"&&d.includes("google.com/maps"),N){const i=d.match(/@([\d.\-]+),([\d.\-]+)/);i&&(i[1],i[2])}const b=s.eta?p(s.eta):null;return e.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-sm border border-gray-100 relative",children:[e.jsx("button",{className:"absolute top-3 right-3 bg-red-100 text-red-700 rounded-full px-3 py-1 text-xs font-semibold hover:bg-red-200",onClick:()=>c(i=>[...i,s.order_id]),title:"Pašalinti šį užsakymą iš sąrašo",children:"Pašalinti"}),!(s.status==="arrived"||s.status==="delivered"||s.status==="cancelled")&&e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"w-full p-3 rounded-lg text-center font-semibold text-blue-800 bg-blue-50 border border-blue-100",children:[e.jsx(T,{className:"w-4 h-4 inline-block mr-1 align-text-bottom text-blue-600"}),s.eta?b>0?`Atvykimo laikas: ${b} min`:"Netrukus atvyks":"Skaičiuojamas atvykimo laikas..."]})}),e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center gap-1.5 px-2 py-1 rounded-lg border mb-1 ${g.bgColor} ${g.textColor} ${g.borderColor}`,children:[g.icon,e.jsx("span",{className:"text-xs",children:g.label})]}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-500 text-sm",children:[e.jsx(L,{className:"w-3 h-3"}),e.jsx("span",{children:B(s.created_at)})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-gray-900",children:["€",s.total||"0.00"]}),e.jsxs("div",{className:"text-gray-500 text-sm",children:[u.split(",").length," prekės"]})]})]}),e.jsx("div",{className:"space-y-2 mb-4",children:(()=>{let i=[];try{i=typeof s.items=="string"?JSON.parse(s.items):s.items}catch{}return Array.isArray(i)||(i=[]),i.map((r,j)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-lg w-8 h-8 flex items-center justify-center overflow-hidden rounded",children:r.image_url?e.jsx("img",{src:r.image_url,alt:r.name||"",className:"w-full h-full object-cover rounded",onError:y=>{y.target.style.display="none"}}):e.jsx("span",{className:"text-2xl",children:r.emoji})}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"text-sm text-gray-900",children:(r.name||r.meal||"")+(r.qty?` x${r.qty}`:"")})})]},j))})()}),s.comment&&e.jsxs("div",{className:"flex items-start gap-2 mb-3 p-3 bg-green-50 rounded-lg border border-green-100",children:[e.jsx(U,{className:"w-4 h-4 text-green-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-green-700 mb-1",children:"Komentaras:"}),e.jsx("div",{className:"text-sm text-green-800",children:s.comment})]})]}),d&&e.jsx("div",{className:"space-y-2 text-sm text-gray-600",children:e.jsx("div",{children:(()=>{let i=null,r=null,j=!1;if(typeof d=="string"){let y=d.match(/@([\d.\-]+),([\d.\-]+)/);y||(y=d.match(/q=([\d.\-]+),([\d.\-]+)/)),y&&(i=y[1],r=y[2],j=!0)}return j&&i&&r?e.jsx(e.Fragment,{children:e.jsx("iframe",{title:"Google Map",width:"100%",height:"180",className:"rounded-lg border mt-2",src:`https://maps.google.com/maps?q=${i},${r}&z=15&output=embed`,allowFullScreen:!0})}):e.jsx("span",{children:typeof d=="string"?d:JSON.stringify(d)})})()})})]},s.order_id)})})]})}function V(){const[n,l]=h.useState("products"),[c,p]=h.useState({}),[s,g]=h.useState([]),[u,x]=h.useState(!1),[d,N]=h.useState(null),[b,i]=h.useState([]);h.useEffect(()=>{(async()=>{try{const a=await(await fetch("/api/products")).json();a.products&&i(a.products.filter(o=>o.available).map(o=>({...o,price:typeof o.price_1=="number"?o.price_1:Number(o.price_1)||0})))}catch{i([])}})()},[]),h.useEffect(()=>{var m;if(window.Telegram&&window.Telegram.WebApp){window.Telegram.WebApp.ready();const t=(m=window.Telegram.WebApp.initDataUnsafe)==null?void 0:m.user;t&&(N(t),r(t.id))}},[]);const r=async m=>{try{const a=await(await fetch(`/api/orders?user_id=${m}`)).json();a.orders&&g(a.orders)}catch(t){console.error("Error loading past orders:",t)}},j=(m,t)=>{p(a=>({...a,[m]:t}))},y=()=>{p({})};function f(m,t){if(!Array.isArray(m))return 0;const a=m.find(o=>t>=o.min&&t<=o.max);return a?a.price:0}function C(m,t){return f(m.price_ranges,t)*t}const M=async({address:m,comment:t}={})=>{if(!d){alert("Prisijunkite prie Telegram, kad galėtumėte pateikti užsakymą");return}const a=b.filter(o=>c[o.id]>0);if(a.length===0){alert("Į krepšelį pridėkite bent vieną prekę");return}x(!0);try{const o={meal:a.map(k=>`${k.name} x${c[k.id]}`).join(", "),user:d,location:m?{manual:m}:{lat:0,lng:0},comment:t||"",items:a.map(k=>({id:k.id,name:k.name,price:C(k,c[k.id]),qty:c[k.id],emoji:k.emoji||""})),total:a.reduce((k,$)=>k+C($,c[$.id]),0)};(await(await fetch("/api/order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).json()).success?(alert("Užsakymas sėkmingai pateiktas!"),p({}),r(d.id),l("history")):alert("Nepavyko pateikti užsakymo. Bandykite dar kartą.")}catch(o){console.error("Klaida pateikiant užsakymą:",o),alert("Klaida pateikiant užsakymą. Bandykite dar kartą.")}finally{x(!1)}},v=()=>l("orders"),w=Object.values(c).reduce((m,t)=>m+t,0),S=()=>{switch(n){case"products":return e.jsx(Q,{products:b,cart:c,onQuantityChange:j,onGoToCart:v});case"orders":return e.jsx(R,{products:b,cart:c,onQuantityChange:j,onClearCart:y,onSubmitOrder:M});case"history":return e.jsx(H,{orders:s});default:return null}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"pb-16",children:S()}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-2 py-2",children:e.jsxs("div",{className:"flex",children:[e.jsxs("button",{onClick:()=>l("products"),className:`flex-1 flex flex-col items-center gap-1 py-2 px-3 rounded-xl transition-colors ${n==="products"?"bg-blue-50 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:[e.jsx(O,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Prekės"})]}),e.jsxs("button",{onClick:()=>l("orders"),className:`flex-1 flex flex-col items-center gap-1 py-2 px-3 rounded-xl transition-colors relative ${n==="orders"?"bg-blue-50 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:[e.jsx(F,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Krepšelis"}),w>0&&e.jsx("span",{className:"absolute top-1 right-3 bg-blue-600 text-white rounded-full px-2 py-0.5 text-xs font-bold",children:w})]}),e.jsxs("button",{onClick:()=>l("history"),className:`flex-1 flex flex-col items-center gap-1 py-2 px-3 rounded-xl transition-colors ${n==="history"?"bg-blue-50 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:[e.jsx(J,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Istorija"})]})]})}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Placing your order..."})]})})]})}q.createRoot(document.getElementById("root")).render(e.jsx(G.StrictMode,{children:e.jsx(V,{})}));
