import{c as $,r as n,j as e,a as Z,M as ee,C as P,A as se,b as te,T as ae,P as D,d as re,R as le}from"./index-5d2d8bbb.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=$("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=$("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),oe=c=>{switch(c){case"pending":return{icon:e.jsx(P,{className:"w-4 h-4"}),label:"Pending",bgColor:"bg-yellow-100",textColor:"text-yellow-700",borderColor:"border-yellow-200"};case"preparing":return{icon:e.jsx(D,{className:"w-4 h-4"}),label:"Preparing",bgColor:"bg-blue-100",textColor:"text-blue-700",borderColor:"border-blue-200"};case"on-the-way":case"arriving":return{icon:e.jsx(ae,{className:"w-4 h-4"}),label:"On the way",bgColor:"bg-orange-100",textColor:"text-orange-700",borderColor:"border-orange-200"};case"delivered":case"arrived":return{icon:e.jsx(te,{className:"w-4 h-4"}),label:"Delivered",bgColor:"bg-green-100",textColor:"text-green-700",borderColor:"border-green-200"};case"cancelled":return{icon:e.jsx(se,{className:"w-4 h-4"}),label:"Cancelled",bgColor:"bg-red-100",textColor:"text-red-700",borderColor:"border-red-200"};default:return{icon:e.jsx(P,{className:"w-4 h-4"}),label:c||"Unknown",bgColor:"bg-gray-100",textColor:"text-gray-700",borderColor:"border-gray-200"}}},de=c=>new Date(c).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});function ce(){const[c,j]=n.useState([]),[T,b]=n.useState(!0),[h,p]=n.useState({}),[x,U]=n.useState("pending"),[u,k]=n.useState({}),[L,R]=n.useState({}),[v,q]=n.useState(""),[F,N]=n.useState(!1),[_,w]=n.useState(""),[m,C]=n.useState("orders"),[S,I]=n.useState(""),[z,A]=n.useState(!1),[E,O]=n.useState(""),J=[{key:"pending",label:"Pending"},{key:"arriving",label:"On the way"},{key:"arrived",label:"Delivered"},{key:"cancelled",label:"Cancelled"}],B=[{value:"pending",label:"Pending"},{value:"arriving",label:"On the way"},{value:"arrived",label:"Delivered"},{value:"cancelled",label:"Cancelled"}],H="mainadmin";n.useEffect(()=>{f()},[]);const f=async(s=v)=>{try{b(!0);const a=await fetch(`/api/admin-orders?password=${encodeURIComponent(s)}`);if(a.status===401){w("Incorrect password"),N(!1),b(!1);return}w(""),N(!0);const i=await a.json();if(i.orders){j(i.orders);const t={},r={};i.orders.forEach(l=>{t[l.user_id]=l.admin_note||"",r[l.user_id]=(r[l.user_id]||0)+1}),k(t),R(r)}}catch{w("Error loading orders"),N(!1),b(!1)}finally{b(!1)}},y=async(s,a,i="",t="",r="",l="",d="")=>{p(o=>({...o,[s]:!0}));try{(await fetch("/api/admin-orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({order_id:s,status:a,comment:i,eta:t,driver_location:r,admin_note:l,user_id:d})})).ok?await f():alert("Failed to update order status")}catch(o){console.error("Error updating order:",o),alert("Error updating order status")}finally{p(o=>({...o,[s]:!1}))}},W=async(s,a)=>{await y(s.order_id,a,s.comment,s.eta,s.driver_location,u[s.user_id],s.user_id)},K=(s,a)=>{k(i=>({...i,[s]:a}))},G=async s=>{await y(s.order_id,s.status,s.comment,s.eta,s.driver_location,u[s.user_id],s.user_id)},V=async(s,a)=>{await y(s.order_id,s.status,s.comment,String(a),s.driver_location,u[s.user_id],s.user_id)},Q=async s=>{if(window.confirm("Are you sure you want to remove this order?")){p(a=>({...a,[s]:!0}));try{(await fetch("/api/admin-orders",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({order_id:s,password:v})})).ok?j(i=>i.filter(t=>t.order_id!==s)):alert("Failed to remove order")}catch{alert("Error removing order")}finally{p(a=>({...a,[s]:!1}))}}},X=()=>e.jsx("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200 mb-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex gap-2 px-4 py-2",children:[e.jsxs("button",{onClick:()=>C("orders"),className:`flex-1 flex flex-col items-center gap-1 py-2 px-3 rounded-xl transition-colors ${m==="orders"?"bg-blue-50 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:[e.jsx(D,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-semibold",children:"Orders"})]}),e.jsxs("button",{onClick:()=>C("messages"),className:`flex-1 flex flex-col items-center gap-1 py-2 px-3 rounded-xl transition-colors ${m==="messages"?"bg-blue-50 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:[e.jsx(ne,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-semibold",children:"Messages"})]}),e.jsxs("button",{onClick:()=>C("admin"),className:`flex-1 flex flex-col items-center gap-1 py-2 px-3 rounded-xl transition-colors ${m==="admin"?"bg-blue-50 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:[e.jsx(ie,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-semibold",children:"âš¡ Admin"})]})]})}),Y=()=>e.jsx("div",{className:"min-h-[300px] flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-lg w-full max-w-xs flex flex-col gap-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 text-center",children:"Main Admin Login"}),e.jsx("input",{type:"password",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter main admin password",value:S,onChange:s=>I(s.target.value),onKeyDown:s=>{s.key==="Enter"&&M()},autoFocus:!0}),E&&e.jsx("div",{className:"text-red-600 text-sm text-center",children:E}),e.jsx("button",{className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded-lg",onClick:M,children:"Login"})]})}),M=()=>{S===H?(A(!0),O("")):(O("Incorrect password"),A(!1))};return F?T?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading orders..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[X(),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[m==="orders"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto mb-6",children:e.jsx("div",{className:"flex gap-2 min-w-max w-full",children:J.map(s=>e.jsx("button",{onClick:()=>U(s.key),className:`flex-1 px-4 py-2 rounded-lg font-medium border transition-colors whitespace-nowrap ${x===s.key?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-200 hover:bg-gray-100"}`,style:{minWidth:120},children:s.label},s.key))})}),c.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“¦"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No orders yet"}),e.jsx("p",{className:"text-gray-600",children:"Orders will appear here when customers place them"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.filter(s=>x==="pending"?s.status==="pending":x==="arriving"?s.status==="arriving"||s.status==="on-the-way":x==="arrived"?s.status==="arrived"||s.status==="delivered":x==="cancelled"?s.status==="cancelled":!0).map(s=>{const a=oe(s.status);let i="";try{const t=typeof s.items=="string"?JSON.parse(s.items):s.items;i=Array.isArray(t)?t.map(r=>{const l=r.name||r.meal||"",d=r.qty?` x${r.qty}`:"";return`${r.emoji?r.emoji+" ":""}${l}${l.includes("x")?"":d}`}).join(`
`):s.items}catch{i=s.items}return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center gap-1.5 px-3 py-1 rounded-full border mb-1 ${a.bgColor} ${a.textColor} ${a.borderColor}`,children:[a.icon,e.jsx("span",{className:"text-sm font-medium",children:a.label})]}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-500 text-sm",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:de(s.created_at)})]})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Order Items:"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:e.jsx("p",{className:"text-gray-700 whitespace-pre-line",children:i})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Total:"}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-3 border border-blue-100",children:e.jsxs("span",{className:"text-blue-800 font-semibold",children:["â‚¬",s.total||"0.00"]})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"User:"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 flex flex-col gap-1",children:[e.jsxs("span",{className:"text-gray-700",children:["ID: ",s.user_id]}),e.jsxs("span",{className:"text-gray-700",children:["Orders placed: ",L[s.user_id]||1]})]})]}),s.comment&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Comment:"}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-3 border border-blue-100",children:e.jsx("p",{className:"text-blue-800",children:s.comment})})]}),s.location&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Location:"}),(()=>{let t=s.location;try{typeof t=="string"&&(t=JSON.parse(t))}catch{}const r=(t==null?void 0:t.manual)||t;let l=null,d=null,o=!1;if(typeof r=="string"){let g=r.match(/@([\d.\-]+),([\d.\-]+)/);g||(g=r.match(/q=([\d.\-]+),([\d.\-]+)/)),g&&(l=g[1],d=g[2],o=!0)}return o&&l&&d?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("iframe",{title:"Map",width:"100%",height:"200",className:"rounded-lg border",src:`https://maps.google.com/maps?q=${l},${d}&z=15&output=embed`,allowFullScreen:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("a",{href:`https://waze.com/ul?ll=${l},${d}&navigate=yes`,target:"_blank",rel:"noopener noreferrer",className:"bg-blue-100 text-blue-700 px-3 py-2 rounded-xl text-xs font-semibold hover:bg-blue-200",children:"Go with Waze"}),e.jsx("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:"bg-gray-100 text-gray-700 px-3 py-2 rounded-xl text-xs font-semibold hover:bg-gray-200",children:"Open in Maps"})]})]}):e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{children:typeof t=="string"?t:JSON.stringify(t)})]})})()]}),e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Update Status:"}),e.jsx("select",{value:s.status,onChange:t=>W(s,t.target.value),disabled:h[s.order_id],className:"w-full px-3 py-2 border border-blue-400 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-blue-50 text-blue-900 font-semibold shadow-sm transition-all",children:B.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ETA (minutes):"}),e.jsx("input",{type:"text",placeholder:"e.g., 15",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",defaultValue:s.eta||"",onBlur:t=>y(s.order_id,s.status,s.comment,t.target.value,s.driver_location,u[s.user_id],s.user_id)})]})]}),e.jsx("div",{className:"flex gap-2 mb-4",children:[10,5,2].map(t=>e.jsxs("button",{onClick:()=>V(s,t),className:"px-3 py-1 rounded-lg bg-blue-100 text-blue-700 font-semibold hover:bg-blue-200 border border-blue-200 transition-colors",disabled:h[s.order_id],children:[t," min"]},t))}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Admin Note (private):"}),e.jsx("textarea",{className:"w-full rounded-lg border border-gray-300 p-2 text-gray-800 bg-yellow-50 focus:ring-2 focus:ring-yellow-400 focus:border-yellow-400",rows:2,value:u[s.user_id]||"",onChange:t=>K(s.user_id,t.target.value),onBlur:()=>G(s),placeholder:"Add a private note about this user..."})]}),e.jsx("div",{className:"flex justify-end mt-2",children:e.jsx("button",{className:"px-3 py-1 rounded-lg bg-red-100 text-red-700 font-semibold hover:bg-red-200 border border-red-200 transition-colors text-sm",onClick:()=>Q(s.order_id),disabled:h[s.order_id],children:"Remove Order"})}),h[s.order_id]&&e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-blue-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-sm",children:"Updating..."})]})]},s.order_id)})})]}),m==="messages"&&e.jsx("div",{className:"min-h-[300px] flex items-center justify-center text-gray-500 text-lg",children:"Messages (coming soon)"}),m==="admin"&&(z?e.jsxs("div",{className:"min-h-[300px] flex flex-col items-center justify-center text-gray-700",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Driver Stats"}),e.jsx("div",{className:"bg-white rounded-xl shadow p-6 w-full max-w-lg text-center",children:e.jsx("div",{className:"text-gray-500",children:"Driver stats and analytics will be shown here."})})]}):Y())]})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-lg w-full max-w-xs flex flex-col gap-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 text-center",children:"Admin Login"}),e.jsx("input",{type:"password",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter admin password",value:v,onChange:s=>q(s.target.value),onKeyDown:s=>{s.key==="Enter"&&f()},autoFocus:!0}),_&&e.jsx("div",{className:"text-red-600 text-sm text-center",children:_}),e.jsx("button",{className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded-lg",onClick:()=>f(),children:"Login"})]})})}re.createRoot(document.getElementById("root")).render(e.jsx(le.StrictMode,{children:e.jsx(ce,{})}));
