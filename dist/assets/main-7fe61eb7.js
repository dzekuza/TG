import{c as P,j as e,P as $,r as j,C as M,a as D,A as I,b as _,T as E,d as O,e as q,R as J}from"./index-c971c3a0.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=P("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=P("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=P("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=P("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);function G({products:i,cart:l,onQuantityChange:n,onGoToCart:p}){const t=Object.values(l).reduce((x,m)=>x+m,0),h=i&&i.length>0;return e.jsxs("div",{className:"p-4 pb-32 relative",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-center text-gray-800 mb-2",children:"🍔 Maisto pristatymas"}),e.jsx("p",{className:"text-center text-gray-600 text-sm",children:"Išsirinkite mėgstamus patiekalus"})]}),h?e.jsx("div",{className:"grid grid-cols-2 gap-4",children:i.map(x=>e.jsx($,{product:x,quantity:l[x.id]||0,onQuantityChange:n},x.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-40 text-gray-500 text-lg py-12",children:[e.jsx("span",{className:"text-5xl mb-2",children:"😔"}),e.jsx("span",{children:"Šiuo metu produktų nėra."})]}),t>0&&e.jsxs("button",{className:"fixed left-1/2 -translate-x-1/2 bottom-20 z-30 bg-blue-600 text-white px-8 py-3 rounded-full shadow-lg text-lg font-semibold flex items-center gap-2 animate-fade-in",onClick:p,children:["Į krepšelį (",t,")"]})]})}function K(i,l){if(!Array.isArray(i))return 0;const n=i.find(p=>l>=p.min&&l<=p.max);return n?n.price:0}function R({products:i,cart:l,onQuantityChange:n,onClearCart:p,onSubmitOrder:t}){const[h,x]=j.useState(""),[m,o]=j.useState("");j.useState(!1);const v=i.filter(r=>l[r.id]>0),f=Object.values(l).reduce((r,g)=>r+g,0),s=f,a=(r,g)=>K(r.price_ranges,g)*g,k=v.reduce((r,g)=>r+a(g,l[g.id]),0);let y=0,C=0,w=0;s>=2&&(y=Math.min(.1*(s-1),.3)),s>=1&&s<4?(C=.1*s,w=1):s<6&&(C=.1*(s+1-1),w=6-s);function T(r){return typeof r=="string"&&r.trim().startsWith("https://www.google.com/maps?q=")}return v.length===0?e.jsxs("div",{className:"p-4 pb-20 flex flex-col items-center justify-center min-h-96",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🛒"}),e.jsx("h2",{className:"text-gray-800 mb-2",children:"Jūsų krepšelis tuščias"}),e.jsx("p",{className:"text-gray-600 text-center text-sm",children:"Pridėkite patiekalų iš meniu, kad pradėtumėte užsakymą!"})]}):e.jsxs("div",{className:"p-4 pb-20",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-center text-gray-800 mb-2",children:"🧾 Jūsų užsakymas"}),e.jsxs("p",{className:"text-center text-gray-600 text-sm",children:[f," prekė",f!==1?"s":""," krepšelyje"]})]}),e.jsx("div",{className:"space-y-4 mb-6",children:v.map(r=>{const g=l[r.id],S=a(r,g);return e.jsx("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-xl bg-gray-100 flex items-center justify-center flex-shrink-0 overflow-hidden",children:r.image_url?e.jsx("img",{src:r.image_url,alt:r.name,className:"w-full h-full object-cover rounded-xl",onError:d=>{d.target.style.display="none"}}):e.jsx("span",{className:"text-2xl",children:r.emoji})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"mb-1",children:r.name}),e.jsxs("p",{className:"text-gray-600 text-sm mb-2",children:[g," vnt × €",(S/g).toFixed(2)," = €",S.toFixed(2)]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["Kiekis: ",g]}),e.jsx("button",{onClick:()=>n(r.id,0),className:"text-red-500 hover:text-red-700 transition-colors",children:e.jsx(Q,{className:"w-4 h-4"})})]})]})]})},r.id)})}),s>0&&y<.3&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-2xl p-4 mb-6 text-yellow-800 text-center text-sm",children:["Pridėkite dar ",w," prekę (-es), kad gautumėte ",Math.round(C*100),"% nuolaidą!"]}),y>0&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-2xl p-4 mb-6 text-green-800 text-center text-sm",children:["Nuolaida pritaikyta: -",Math.round(y*100),"%"]}),e.jsx("div",{className:"bg-blue-50 rounded-2xl p-4 mb-6 border border-blue-100",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg text-gray-800",children:"Iš viso:"}),e.jsxs("span",{className:"text-xl text-blue-600",children:["€",k.toFixed(2)]})]})}),e.jsx("div",{className:"mb-6 text-center text-gray-700 text-sm",children:"Paruoškite grynųjų pinigų ir nevėluokite į susitikimo vietą."}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"Pristatymo adresas"}),e.jsx("div",{className:"flex gap-2",children:e.jsx("input",{type:"text",className:"flex-1 rounded-xl border border-gray-300 p-3 text-gray-800",placeholder:"Įveskite adresą arba įklijuokite Google Maps nuorodą",value:h,onChange:r=>x(r.target.value)})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"Komentarai"}),e.jsx("textarea",{className:"w-full rounded-xl border border-gray-300 p-3 text-gray-800",placeholder:"Pastabos kurjeriui? (nebūtina)",value:m,onChange:r=>o(r.target.value),rows:2})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:p,className:"flex-1 bg-gray-100 hover:bg-gray-200 transition-colors rounded-xl p-4 text-gray-700",children:"Išvalyti krepšelį"}),e.jsx("button",{onClick:()=>{if(!T(h)){alert("Įveskite galiojantį Google Maps adresą prieš pateikdami užsakymą.");return}t({address:h,comment:m})},className:"flex-1 bg-green-500 hover:bg-green-600 transition-colors rounded-xl p-4 text-white",children:"Patvirtinti užsakymą"})]})]})}const z=i=>{switch(i){case"pending":return{icon:e.jsx(M,{className:"w-4 h-4"}),label:"Laukiama",bgColor:"bg-yellow-100",textColor:"text-yellow-700",borderColor:"border-yellow-200"};case"preparing":return{icon:e.jsx(O,{className:"w-4 h-4"}),label:"Ruošiama",bgColor:"bg-blue-100",textColor:"text-blue-700",borderColor:"border-blue-200"};case"on-the-way":case"arriving":return{icon:e.jsx(E,{className:"w-4 h-4"}),label:"Pakeliui",bgColor:"bg-orange-100",textColor:"text-orange-700",borderColor:"border-orange-200"};case"delivered":case"arrived":return{icon:e.jsx(_,{className:"w-4 h-4"}),label:"Pristatyta",bgColor:"bg-green-100",textColor:"text-green-700",borderColor:"border-green-200"};case"cancelled":return{icon:e.jsx(I,{className:"w-4 h-4"}),label:"Atšaukta",bgColor:"bg-red-100",textColor:"text-red-700",borderColor:"border-red-200"};default:return{icon:e.jsx(M,{className:"w-4 h-4"}),label:i||"Nežinoma",bgColor:"bg-gray-100",textColor:"text-gray-700",borderColor:"border-gray-200"}}},B=i=>{const l=new Date(i),n=new Date,p=l.toDateString()===n.toDateString(),t=l.toDateString()===new Date(n.getTime()-24*60*60*1e3).toDateString();return p?`Today at ${l.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}`:t?`Yesterday at ${l.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}`:l.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};function H({orders:i=[]}){const[l,n]=j.useState([]);function p(t){const[h,x]=j.useState(null);return j.useEffect(()=>{if(!t)return;const m=setInterval(()=>{const f=new Date(t).getTime(),s=Date.now(),a=Math.max(0,Math.ceil((f-s)/6e4));x(a)},1e4),o=new Date(t).getTime(),v=Date.now();return x(Math.max(0,Math.ceil((o-v)/6e4))),()=>clearInterval(m)},[t]),h}return i.length===0?e.jsxs("div",{className:"p-4 pb-20 flex flex-col items-center justify-center min-h-96",children:[e.jsx("div",{className:"text-6xl mb-4",children:"📋"}),e.jsx("h2",{className:"text-gray-800 mb-2",children:"Nėra užsakymų istorijos"}),e.jsx("p",{className:"text-gray-600 text-center text-sm",children:"Jūsų ankstesni užsakymai atsiras čia, kai pateiksite pirmą užsakymą!"})]}):e.jsxs("div",{className:"p-4 pb-20",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-center text-gray-800 mb-2",children:"📋 Užsakymų istorija"}),e.jsx("p",{className:"text-center text-gray-600 text-sm",children:"Stebėkite savo užsakymų būseną ir pristatymą"})]}),e.jsx("div",{className:"space-y-4",children:i.filter(t=>!l.includes(t.order_id)).map(t=>{const h=z(t.status);let x="";try{const s=typeof t.items=="string"?JSON.parse(t.items):t.items;x=Array.isArray(s)?s.map(a=>`${a.emoji?a.emoji+" ":""}${a.name||a.meal||""}${a.qty?" x"+a.qty:""}`).join(", "):t.items}catch{x=t.items}let m=t.location,o="",v=!1;try{typeof m=="string"&&m.startsWith("{")&&(m=JSON.parse(m))}catch{}if(o=(m==null?void 0:m.manual)||m,v=typeof o=="string"&&o.includes("google.com/maps"),v){const s=o.match(/@([\d.\-]+),([\d.\-]+)/);s&&(s[1],s[2])}const f=t.eta?p(t.eta):null;return e.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-sm border border-gray-100 relative",children:[e.jsx("button",{className:"absolute top-3 right-3 bg-red-100 text-red-700 rounded-full px-3 py-1 text-xs font-semibold hover:bg-red-200",onClick:()=>n(s=>[...s,t.order_id]),title:"Pašalinti šį užsakymą iš sąrašo",children:"Pašalinti"}),!(t.status==="arrived"||t.status==="delivered"||t.status==="cancelled")&&e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"w-full p-3 rounded-lg text-center font-semibold text-blue-800 bg-blue-50 border border-blue-100",children:[e.jsx(M,{className:"w-4 h-4 inline-block mr-1 align-text-bottom text-blue-600"}),t.eta?f>0?`Atvykimo laikas: ${f} min`:"Netrukus atvyks":"Skaičiuojamas atvykimo laikas..."]})}),e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center gap-1.5 px-2 py-1 rounded-lg border mb-1 ${h.bgColor} ${h.textColor} ${h.borderColor}`,children:[h.icon,e.jsx("span",{className:"text-xs",children:h.label})]}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-500 text-sm",children:[e.jsx(D,{className:"w-3 h-3"}),e.jsx("span",{children:B(t.created_at)})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-gray-900",children:["€",t.total||"0.00"]}),e.jsxs("div",{className:"text-gray-500 text-sm",children:[x.split(",").length," prekės"]})]})]}),e.jsx("div",{className:"space-y-2 mb-4",children:(()=>{let s=[];try{s=typeof t.items=="string"?JSON.parse(t.items):t.items}catch{}return Array.isArray(s)||(s=[]),s.map((a,k)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-lg w-8 h-8 flex items-center justify-center overflow-hidden rounded",children:a.image_url?e.jsx("img",{src:a.image_url,alt:a.name||"",className:"w-full h-full object-cover rounded",onError:y=>{y.target.style.display="none"}}):e.jsx("span",{className:"text-2xl",children:a.emoji})}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"text-sm text-gray-900",children:(a.name||a.meal||"")+(a.qty?` x${a.qty}`:"")})})]},k))})()}),t.comment&&e.jsxs("div",{className:"flex items-start gap-2 mb-3 p-3 bg-green-50 rounded-lg border border-green-100",children:[e.jsx(U,{className:"w-4 h-4 text-green-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-green-700 mb-1",children:"Komentaras:"}),e.jsx("div",{className:"text-sm text-green-800",children:t.comment})]})]}),o&&e.jsx("div",{className:"space-y-2 text-sm text-gray-600",children:e.jsx("div",{children:(()=>{let s=null,a=null,k=!1;if(typeof o=="string"){let y=o.match(/@([\d.\-]+),([\d.\-]+)/);y||(y=o.match(/q=([\d.\-]+),([\d.\-]+)/)),y&&(s=y[1],a=y[2],k=!0)}return k&&s&&a?e.jsx(e.Fragment,{children:e.jsx("iframe",{title:"Google Map",width:"100%",height:"180",className:"rounded-lg border mt-2",src:`https://maps.google.com/maps?q=${s},${a}&z=15&output=embed`,allowFullScreen:!0})}):e.jsx("span",{children:typeof o=="string"?o:JSON.stringify(o)})})()})})]},t.order_id)})})]})}function V(){const[i,l]=j.useState("products"),[n,p]=j.useState({}),[t,h]=j.useState([]),[x,m]=j.useState(!1),[o,v]=j.useState(null),[f,s]=j.useState([]);j.useEffect(()=>{(async()=>{try{const u=await(await fetch("/api/products")).json();u.products&&s(u.products.filter(b=>b.available).map(b=>({...b,price:typeof b.price_1=="number"?b.price_1:Number(b.price_1)||0})))}catch{s([])}})()},[]),j.useEffect(()=>{var d;if(window.Telegram&&window.Telegram.WebApp){window.Telegram.WebApp.ready();const c=(d=window.Telegram.WebApp.initDataUnsafe)==null?void 0:d.user;c&&(v(c),a(c.id))}},[]);const a=async d=>{try{const u=await(await fetch(`/api/orders?user_id=${d}`)).json();u.orders&&h(u.orders)}catch(c){console.error("Error loading past orders:",c)}},k=(d,c)=>{p(u=>({...u,[d]:c}))},y=()=>{p({})};function C(d,c){if(!Array.isArray(d))return 0;const u=d.find(b=>c>=b.min&&c<=b.max);return u?u.price:0}function w(d,c){return C(d.price_ranges,c)*c}const T=async({address:d,comment:c}={})=>{if(!o){alert("Prisijunkite prie Telegram, kad galėtumėte pateikti užsakymą");return}const u=f.filter(b=>n[b.id]>0);if(u.length===0){alert("Į krepšelį pridėkite bent vieną prekę");return}m(!0);try{const b={meal:u.map(N=>`${N.name} x${n[N.id]}`).join(", "),user:o,location:d?{manual:d}:{lat:0,lng:0},comment:c||"",items:u.map(N=>({id:N.id,name:N.name,price:w(N,n[N.id]),qty:n[N.id],emoji:N.emoji||""})),total:u.reduce((N,A)=>N+w(A,n[A.id]),0)};(await(await fetch("/api/order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)})).json()).success?(alert("Užsakymas sėkmingai pateiktas!"),p({}),a(o.id),l("history")):alert("Nepavyko pateikti užsakymo. Bandykite dar kartą.")}catch(b){console.error("Klaida pateikiant užsakymą:",b),alert("Klaida pateikiant užsakymą. Bandykite dar kartą.")}finally{m(!1)}},r=()=>l("orders"),g=Object.values(n).reduce((d,c)=>d+c,0),S=()=>{switch(i){case"products":return e.jsx(G,{products:f,cart:n,onQuantityChange:k,onGoToCart:r});case"orders":return e.jsx(R,{products:f,cart:n,onQuantityChange:k,onClearCart:y,onSubmitOrder:T});case"history":return e.jsx(H,{orders:t});default:return null}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"pb-16",children:S()}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-2 py-2",children:e.jsxs("div",{className:"flex",children:[e.jsxs("button",{onClick:()=>l("products"),className:`flex-1 flex flex-col items-center gap-1 py-2 px-3 rounded-xl transition-colors ${i==="products"?"bg-blue-50 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:[e.jsx(O,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Prekės"})]}),e.jsxs("button",{onClick:()=>l("orders"),className:`flex-1 flex flex-col items-center gap-1 py-2 px-3 rounded-xl transition-colors relative ${i==="orders"?"bg-blue-50 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:[e.jsx(F,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Krepšelis"}),g>0&&e.jsx("span",{className:"absolute top-1 right-3 bg-blue-600 text-white rounded-full px-2 py-0.5 text-xs font-bold",children:g})]}),e.jsxs("button",{onClick:()=>l("history"),className:`flex-1 flex flex-col items-center gap-1 py-2 px-3 rounded-xl transition-colors ${i==="history"?"bg-blue-50 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:[e.jsx(L,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Istorija"})]})]})}),x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Placing your order..."})]})})]})}q.createRoot(document.getElementById("root")).render(e.jsx(J.StrictMode,{children:e.jsx(V,{})}));
